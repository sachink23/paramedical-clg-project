class result {
    http = new xhr;
    getExams(fun, ext) {
        var data = new FormData();
        data.append("request", "getExams");
        this.http.post("/api/results/", data, fun, ext);
    }
    getResult() {
      var examId = document.getElementById("selectExam");
      var rn = document.getElementById("rollNo");
      var date = document.getElementById("date");
      if(!((!isNaN(examId.value)) && (!(examId.value == "")))) {
        alert("Select Exam First");
        return false;
      } 
      var data = new FormData();
      data.append("request", "getResult");
      data.append("examId", examId.value);
      data.append("rollNo", rn.value);
      data.append("dob", date.value);
      this.http.post("/api/results/", data, res.displayResult, ['displayResultLink', 'displayResult']);
    }
    displayResult(status, res, extra) {
      try {
        var res = JSON.parse(res);
      } catch {
        var html =
          '<p class="text-danger">Some error occurred, please try again.</p>';
        document.getElementById(extra[0]).innerHTML = html;
        document.getElementById(extra[1]).innerHTML = "";
        return false;
      }
      if (status == 200) {
        if (res.code == 200) {
          var html = "<p class='text-success'><a href='" + res.message + "' download>Download Result</a></p>";
          document.getElementById(extra[1]).innerHTML = "<embed src='"+res.message+"' width='100%' height='600px'>";
          document.getElementById(extra[0]).innerHTML = html;
          return true;
        } else if (res.code == 201) {
          var html =
            "<p class='text-danger'>No result found</p>";
        } else if(res.code == 400) {
          var html = "<p class='text-danger'>Please check all the fields, No result Found.</p>";
        } else {
          console.log(res);
          var html = "<p class='text-danger'>Please check all the fields, No result Found.</p>";
        }
      } else if (status == 0) {
        var html =
          "<p class='text-danger'>Failed to connect with server, check internet connection</p>";
      } else {
        var html = '<p class="text-danger">Some error occurred, please try again.</p>';

      }
      document.getElementById(extra[0]).innerHTML = html;
      document.getElementById(extra[1]).innerHTML ="";
    } 
    getExamsInSelect(status, res, ext) {
        try {
            var res = JSON.parse(res);
          } catch {
            console.log(status, res);
            var html =
              '<option id="'+ext[0]+'-def" value="">Something Went Wrong Please Check Console for more Information</option>';
      
            document.getElementById(ext[1]).innerHTML = html;
            return false;
          }
          if (status == 200) {
            if (res.code == 200) {
                var j=0;
                for(var i = 0; i < res.data.length; i++) {
                    if(j==0) {
                        html = "<option id='"+ext[0]+"-def' value=''>Select Exam</option>"
                    }
                    html+="<option id='"+ext[0]+"-"+res.data[i].exam_id+"' value='"+res.data[i].exam_id+"'>"+res.data[i].exam_name+"</option>";
                    j++;
                }
                
            } else if (res.code == 201) {
              var html =
              '<option id="'+ext[0]+'-def" value="">No exams found</option>';
            } else if(res.code == 400) {
              var html = "<option id='"+ext[0]+"-"+res.data[i].exam_id+" value=''>Bad request, please contact administrator with message - "+res.message+"</option>";
            } else {
              console.log(res);
              var html = "<option id='"+ext[0]+"-"+res.data[i].exam_id+" value=''>" + res.message + "</option>";
            }
          } else if (status == 0) {
            var html =
              "<option value='' id='"+ext[0]+"-"+res.data[i].exam_id+" class='text-danger'>Failed to connect with server, check internet connection</option>";
          } else if (status == 403) {
            var html =
            "<option value='' id='"+ext[0]+"-"+res.data[i].exam_id+" class='text-danger'>Access Denied, Login First</option>";

          } else {
            console.log(res);
            var html =
            "<option value='' id='"+ext[0]+"-"+res.data[i].exam_id+" class='text-danger'>Something wrong</option>";            
          }
          document.getElementById(ext[1]).innerHTML = html;
    }
}
var res = new result;